<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chromeä¹¦ç­¾æµè§ˆå™¨</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Microsoft YaHei", sans-serif;
        line-height: 1.6;
        color: #333;
        padding: 20px;
        background-color: #f5f7fa;
      }
      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 10px;
      }
      .header {
        display: flex;
        margin-bottom: 20px;
        justify-content: space-between;
        align-items: center;
      }
      .search-container {
        flex-grow: 1;
        margin-right: 10px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        padding: 5px;
        transition: all 0.3s ease;
      }
      .search-container:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
      }
      .search-input {
        width: 100%;
        padding: 10px 15px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        outline: none;
        background-color: transparent;
      }
      .upload-container {
        position: relative;
      }
      .upload-btn {
        padding: 8px 15px;
        background-color: #f1f1f1;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
      }
      .upload-btn:hover {
        background-color: #e9e9e9;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
      }
      .upload-icon {
        margin-right: 5px;
        font-size: 16px;
      }
      .content {
        display: flex;
        gap: 20px;
      }
      .sidebar {
        width: 25%;
        background-color: #fff;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        overflow-y: auto;
        max-height: 80vh;
        transition: all 0.3s ease;
      }
      .sidebar:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
      }
      .main-content {
        width: 75%;
        background-color: #fff;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        overflow-y: auto;
        max-height: 80vh;
        transition: all 0.3s ease;
      }
      .main-content:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
      }
      .tab-buttons {
        display: flex;
        margin-bottom: 15px;
        border-bottom: 1px solid #eee;
        gap: 2px;
      }
      .tab-button {
        padding: 8px 15px;
        background-color: #f9f9f9;
        border: none;
        border-radius: 6px 6px 0 0;
        margin-right: 2px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 14px;
      }
      .tab-button:hover {
        background-color: #f0f0f0;
      }
      .tab-button.active {
        background-color: #fff;
        border-bottom: 2px solid #4a6cf7;
        font-weight: bold;
        color: #4a6cf7;
      }
      .folder-title {
        padding: 10px 12px;
        background-color: #f9f9f9;
        border-radius: 6px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }
      .folder-title:hover {
        background-color: #f0f0f0;
        transform: translateY(-1px);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
      }
      .bookmark-item {
        display: block;
        padding: 8px 12px;
        margin: 6px 0;
        border-radius: 6px;
        text-decoration: none;
        color: #0066cc;
        transition: all 0.2s ease;
        background-color: #f9f9f9;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      }
      .bookmark-item:hover {
        background-color: #f0f0f0;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
      }
      .folder-content {
        margin-left: 20px;
        border-left: 2px solid #eee;
        padding-left: 10px;
      }
      .hidden {
        display: none;
      }
      .breadcrumb {
        padding: 12px;
        background-color: #f9f9f9;
        border-radius: 6px;
        margin-bottom: 15px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }
      .breadcrumb span {
        transition: all 0.2s ease;
        padding: 3px 5px;
        border-radius: 4px;
      }
      .breadcrumb span:hover {
        background-color: #f0f0f0;
      }
      .welcome-info {
        padding: 20px;
        background-color: #f7f9ff;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        border-left: 4px solid #4a6cf7;
      }
      .welcome-info h2 {
        margin-bottom: 15px;
        color: #4a6cf7;
      }
      .welcome-info p {
        margin-bottom: 10px;
        color: #555;
      }
      .welcome-info ul {
        margin-left: 20px;
        margin-top: 10px;
      }
      .welcome-info code {
        background-color: #f0f0f0;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: monospace;
      }
      .drop-zone {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(74, 108, 247, 0.2);
        z-index: 1000;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      .drop-zone.active {
        opacity: 1;
        visibility: visible;
      }
      .drop-zone-message {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        text-align: center;
        font-size: 20px;
        color: #4a6cf7;
      }
      .search-result {
        margin-bottom: 8px;
      }
      @media (max-width: 768px) {
        .content {
          flex-direction: column;
        }
        .sidebar, .main-content {
          width: 100%;
          max-height: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="drop-zone" id="drop-zone">
      <div class="drop-zone-message">
        é‡Šæ”¾é¼ æ ‡ä¸Šä¼ ä¹¦ç­¾æ–‡ä»¶
      </div>
    </div>
    <div class="container">
      <div class="header">
        <div class="search-container">
          <input type="text" class="search-input" placeholder="æœç´¢ä¹¦ç­¾å†…å®¹" />
        </div>
        <div class="upload-container">
          <input type="file" id="file-input" style="display: none" />
          <button class="upload-btn" id="upload-button">
            <span class="upload-icon">ğŸ“‚</span> ä¸Šä¼ ä¹¦ç­¾
          </button>
        </div>
      </div>
      <div class="content">
        <div class="sidebar">
          <div class="tab-buttons">
            <button class="tab-button active" data-target="bookmark_bar">
              ä¹¦ç­¾æ 
            </button>
            <button class="tab-button" data-target="other">å…¶ä»–</button>
            <button class="tab-button" data-target="synced">åŒæ­¥</button>
          </div>
          <div id="sidebar-content"></div>
        </div>
        <div class="main-content" id="main-content">
          <div class="breadcrumb" id="breadcrumb"></div>
          <div id="bookmark-content">
            <div id="welcome-info" class="welcome-info">
              <h2>Chromeä¹¦ç­¾æµè§ˆå·¥å…·</h2>
              <p>è¯·ç‚¹å‡»å³ä¸Šè§’çš„"ä¸Šä¼ ä¹¦ç­¾"æŒ‰é’®ï¼Œé€‰æ‹©Chromeçš„ä¹¦ç­¾æ–‡ä»¶ã€‚</p>
              <p>
                Chromeä¹¦ç­¾æ–‡ä»¶é€šå¸¸ä½äºï¼š<code
                  >C:\Users\[ç”¨æˆ·å]\AppData\Local\Google\Chrome\User
                  Data\Default\Bookmarks</code
                >
              </p>
              <p>æ³¨æ„ï¼šä¹¦ç­¾æ–‡ä»¶æ²¡æœ‰åç¼€åï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ä¸ªæ ‡å‡†çš„JSONæ–‡ä»¶ã€‚</p>
              <p>æ‚¨ä¹Ÿå¯ä»¥ç›´æ¥æ‹–æ‹½ä¹¦ç­¾æ–‡ä»¶åˆ°æ­¤é¡µé¢è¿›è¡Œä¸Šä¼ ã€‚</p>
              <p>ä¸Šä¼ æˆåŠŸåï¼Œæ‚¨å¯ä»¥ï¼š</p>
              <ul>
                <li>åœ¨å·¦ä¾§æµè§ˆä¹¦ç­¾ç›®å½•ç»“æ„</li>
                <li>ç‚¹å‡»æ–‡ä»¶å¤¹æŸ¥çœ‹å­æ–‡ä»¶å¤¹å’Œä¹¦ç­¾</li>
                <li>ç‚¹å‡»ä¹¦ç­¾ç›´æ¥æ‰“å¼€é“¾æ¥</li>
                <li>ä½¿ç”¨é¡¶éƒ¨æœç´¢æ¡†æœç´¢ä¹¦ç­¾</li>
                <li>é€šè¿‡é¡¶éƒ¨æ ‡ç­¾é¡µåˆ‡æ¢ä¸åŒçš„æ ¹ä¹¦ç­¾ç›®å½•</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // å…¨å±€å˜é‡
      let bookmarksData = null;
      let currentRootFolder = "bookmark_bar";
      let currentPath = [];

      // DOMå…ƒç´ 
      const fileInput = document.getElementById("file-input");
      const uploadButton = document.getElementById("upload-button");
      const searchInput = document.querySelector(".search-input");
      const tabButtons = document.querySelectorAll(".tab-button");
      const sidebarContent = document.getElementById("sidebar-content");
      const bookmarkContent = document.getElementById("bookmark-content");
      const breadcrumbElement = document.getElementById("breadcrumb");
      const dropZone = document.getElementById("drop-zone");

      // äº‹ä»¶ç›‘å¬
      uploadButton.addEventListener("click", () => {
        // è®¾ç½®é»˜è®¤æ‰“å¼€è·¯å¾„ï¼ˆæ³¨æ„ï¼šè¿™åœ¨Webç¯å¢ƒä¸­ä¸èµ·ä½œç”¨ï¼Œä»…ä½œä¸ºæç¤ºï¼‰
        fileInput.nwworkingdir =
          "C:\\Users\\zchcpy\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\";
        fileInput.click();
      });

      fileInput.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (!file) return;
        handleFile(file);
      });

      // æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
      document.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('active');
      });

      document.addEventListener('dragleave', (e) => {
        e.preventDefault();
        if (e.relatedTarget === null || e.relatedTarget.nodeName === 'HTML') {
          dropZone.classList.remove('active');
        }
      });

      dropZone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        dropZone.classList.remove('active');
      });

      document.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('active');
        
        if (e.dataTransfer.files.length) {
          const file = e.dataTransfer.files[0];
          handleFile(file);
        }
      });

      searchInput.addEventListener("input", (e) => {
        const searchTerm = e.target.value.toLowerCase();
        if (searchTerm.length < 2) {
          // å¦‚æœæœç´¢è¯å°‘äº2ä¸ªå­—ç¬¦ï¼Œæ¢å¤æ­£å¸¸æ˜¾ç¤º
          initBookmarks();
          return;
        }
        searchBookmarks(searchTerm);
      });

      tabButtons.forEach((button) => {
        button.addEventListener("click", () => {
          tabButtons.forEach((btn) => btn.classList.remove("active"));
          button.classList.add("active");
          currentRootFolder = button.dataset.target;
          currentPath = [];
          initBookmarks();
        });
      });

      // åˆå§‹åŒ–ä¹¦ç­¾
      function initBookmarks() {
        if (!bookmarksData) return;

        // æ¸…é™¤æ¬¢è¿ä¿¡æ¯
        const welcomeInfo = document.getElementById("welcome-info");
        if (welcomeInfo) {
          welcomeInfo.style.display = "none";
        }

        // ç»Ÿè®¡ä¹¦ç­¾æ€»æ•°
        const totalCount = countBookmarks();

        // æ¸…ç©ºå½“å‰è·¯å¾„
        currentPath = [];
        updateBreadcrumb();

        // æ›´æ–°æ ‡é¢˜æ˜¾ç¤ºæ€»æ•°
        document.title = `Chromeä¹¦ç­¾æµè§ˆå™¨ (${totalCount}ä¸ªä¹¦ç­¾)`;

        // æ¸²æŸ“ä¾§è¾¹æ 
        renderSidebar();

        // æ¸²æŸ“ä¸»å†…å®¹åŒºåŸŸï¼ˆé»˜è®¤æ˜¾ç¤ºç¬¬ä¸€ä¸ªä¸€çº§ç›®å½•çš„å†…å®¹ï¼‰
        renderMainContent();
      }

      // ç»Ÿè®¡ä¹¦ç­¾æ€»æ•°
      function countBookmarks() {
        let count = 0;

        function countInItems(items) {
          if (!items) return;

          items.forEach((item) => {
            if (item.type === "url") {
              count++;
            }

            if (item.children) {
              countInItems(item.children);
            }
          });
        }

        // åœ¨æ‰€æœ‰æ ¹æ–‡ä»¶å¤¹ä¸­è®¡æ•°
        ["bookmark_bar", "other", "synced"].forEach((rootKey) => {
          const rootFolder = bookmarksData.roots[rootKey];
          if (rootFolder && rootFolder.children) {
            countInItems(rootFolder.children);
          }
        });

        return count;
      }

      // æ¸²æŸ“ä¾§è¾¹æ 
      function renderSidebar() {
        sidebarContent.innerHTML = "";

        const rootFolder = bookmarksData.roots[currentRootFolder];
        if (!rootFolder || !rootFolder.children) {
          sidebarContent.innerHTML = "<p>æ²¡æœ‰æ‰¾åˆ°ä¹¦ç­¾å†…å®¹</p>";
          return;
        }

        // æ¸²æŸ“ä¸€çº§ç›®å½•
        rootFolder.children.forEach((item, index) => {
          if (item.type === "folder") {
            const folderElement = document.createElement("div");
            folderElement.className = "folder-title";
            folderElement.textContent = item.name;
            folderElement.dataset.index = index;

            folderElement.addEventListener("click", () => {
              currentPath = [index];
              updateBreadcrumb();
              renderMainContent();

              // é«˜äº®é€‰ä¸­çš„æ–‡ä»¶å¤¹
              document.querySelectorAll(".folder-title").forEach((el) => {
                el.style.fontWeight = "normal";
                el.style.backgroundColor = "#f9f9f9";
              });
              folderElement.style.fontWeight = "bold";
              folderElement.style.backgroundColor = "#edf0ff";
            });

            sidebarContent.appendChild(folderElement);
          }
        });

        // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªæ–‡ä»¶å¤¹
        if (rootFolder.children.length > 0) {
          const firstFolder = sidebarContent.querySelector(".folder-title");
          if (firstFolder) {
            firstFolder.click();
          }
        }
      }

      // æ¸²æŸ“ä¸»å†…å®¹åŒºåŸŸ
      function renderMainContent() {
        bookmarkContent.innerHTML = "";

        if (!bookmarksData) return;

        let currentItems = bookmarksData.roots[currentRootFolder].children;

        // æ ¹æ®å½“å‰è·¯å¾„è·å–è¦æ˜¾ç¤ºçš„items
        for (const index of currentPath) {
          if (currentItems[index] && currentItems[index].children) {
            currentItems = currentItems[index].children;
          } else {
            break;
          }
        }

        // æ¸²æŸ“å½“å‰å±‚çº§çš„å†…å®¹
        if (currentItems && currentItems.length > 0) {
          renderBookmarkItems(currentItems, bookmarkContent);
        } else {
          bookmarkContent.innerHTML = "<p>æ²¡æœ‰ä¹¦ç­¾å†…å®¹</p>";
        }
      }

      // æ¸²æŸ“ä¹¦ç­¾é¡¹ç›®
      function renderBookmarkItems(items, container) {
        items.forEach((item, index) => {
          if (item.type === "folder") {
            const folderElement = document.createElement("div");
            folderElement.className = "folder-title";
            folderElement.textContent = item.name;

            folderElement.addEventListener("click", () => {
              // è·å–å½“å‰å±‚çº§çš„è·¯å¾„
              const newPath = [...currentPath, index];

              // æ›´æ–°å½“å‰è·¯å¾„
              currentPath = newPath;
              updateBreadcrumb();

              // æ¸²æŸ“æ–°å†…å®¹
              renderMainContent();
            });

            container.appendChild(folderElement);
          } else if (item.type === "url") {
            const linkElement = document.createElement("a");
            linkElement.className = "bookmark-item";
            linkElement.href = item.url;
            linkElement.textContent = item.name;
            linkElement.target = "_blank";
            container.appendChild(linkElement);
          }
        });
      }

      // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
      function updateBreadcrumb() {
        breadcrumbElement.innerHTML = "";

        // æ·»åŠ æ ¹ç›®å½•
        const rootElement = document.createElement("span");
        rootElement.textContent = getRootFolderName(currentRootFolder);
        rootElement.style.cursor = "pointer";
        rootElement.addEventListener("click", () => {
          currentPath = [];
          updateBreadcrumb();
          renderMainContent();
        });
        breadcrumbElement.appendChild(rootElement);

        // æ·»åŠ å½“å‰è·¯å¾„
        let currentItems = bookmarksData.roots[currentRootFolder].children;
        let partialPath = [];

        currentPath.forEach((index, level) => {
          breadcrumbElement.appendChild(document.createTextNode(" > "));

          const item = currentItems[index];
          if (item) {
            partialPath.push(index);

            const pathElement = document.createElement("span");
            pathElement.textContent = item.name;
            pathElement.style.cursor = "pointer";

            // ä¸ºè·¯å¾„å…ƒç´ æ·»åŠ ç‚¹å‡»äº‹ä»¶
            const thisPath = [...partialPath];
            pathElement.addEventListener("click", () => {
              currentPath = thisPath;
              updateBreadcrumb();
              renderMainContent();
            });

            breadcrumbElement.appendChild(pathElement);

            // æ›´æ–°å½“å‰itemsä»¥ä¾¿è·å–ä¸‹ä¸€çº§
            if (item.children) {
              currentItems = item.children;
            }
          }
        });
      }

      // è·å–æ ¹æ–‡ä»¶å¤¹çš„æ˜¾ç¤ºåç§°
      function getRootFolderName(rootKey) {
        switch (rootKey) {
          case "bookmark_bar":
            return "ä¹¦ç­¾æ ";
          case "other":
            return "å…¶ä»–ä¹¦ç­¾";
          case "synced":
            return "åŒæ­¥çš„ä¹¦ç­¾";
          default:
            return rootKey;
        }
      }

      // æœç´¢ä¹¦ç­¾
      function searchBookmarks(searchTerm) {
        bookmarkContent.innerHTML = "";
        breadcrumbElement.innerHTML = `æœç´¢ç»“æœ: "${searchTerm}"`;

        const results = [];

        // é€’å½’æœç´¢ä¹¦ç­¾
        function searchInItems(items, path = []) {
          if (!items) return;

          items.forEach((item, index) => {
            const currentPath = [...path, index];

            if (
              (item.name && item.name.toLowerCase().includes(searchTerm)) ||
              (item.url && item.url.toLowerCase().includes(searchTerm))
            ) {
              results.push({
                item,
                path: currentPath,
              });
            }

            if (item.children) {
              searchInItems(item.children, currentPath);
            }
          });
        }

        // åœ¨æ‰€æœ‰ä¸‰ä¸ªæ ¹æ–‡ä»¶å¤¹ä¸­æœç´¢
        ["bookmark_bar", "other", "synced"].forEach((rootKey) => {
          const rootFolder = bookmarksData.roots[rootKey];
          if (rootFolder && rootFolder.children) {
            searchInItems(rootFolder.children, [rootKey]);
          }
        });

        // æ˜¾ç¤ºæœç´¢ç»“æœ
        if (results.length === 0) {
          bookmarkContent.innerHTML = "<p>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ä¹¦ç­¾</p>";
          return;
        }

        results.forEach((result) => {
          const { item, path } = result;

          const resultItem = document.createElement("div");
          resultItem.className = "search-result";

          if (item.type === "url") {
            const link = document.createElement("a");
            link.href = item.url;
            link.className = "bookmark-item";
            link.textContent = item.name;
            link.target = "_blank";
            resultItem.appendChild(link);
          } else {
            const folderLink = document.createElement("div");
            folderLink.className = "folder-title";
            folderLink.textContent = item.name;

            folderLink.addEventListener("click", () => {
              const rootKey = path[0];
              const folderPath = path.slice(1);

              // åˆ‡æ¢åˆ°å¯¹åº”çš„æ ¹æ–‡ä»¶å¤¹
              document
                .querySelector(`.tab-button[data-target="${rootKey}"]`)
                .click();

              // è®¾ç½®å½“å‰è·¯å¾„åˆ°æœç´¢ç»“æœçš„è·¯å¾„
              currentPath = folderPath;
              updateBreadcrumb();
              renderMainContent();
            });

            resultItem.appendChild(folderLink);
          }

          bookmarkContent.appendChild(resultItem);
        });
      }

      // å¤„ç†æ–‡ä»¶å‡½æ•°
      function handleFile(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            bookmarksData = JSON.parse(e.target.result);
            initBookmarks();
          } catch (error) {
            alert("è§£æä¹¦ç­¾æ–‡ä»¶å¤±è´¥ï¼Œè¯·ç¡®ä¿æ–‡ä»¶æ ¼å¼æ­£ç¡®");
            console.error("è§£æä¹¦ç­¾æ–‡ä»¶å¤±è´¥", error);
          }
        };
        reader.readAsText(file);
      }

      // ä¸ºæ¼”ç¤ºç›®çš„ï¼ŒåŠ è½½demoæ•°æ®
      if (typeof BookmarksDemo !== "undefined") {
        bookmarksData = BookmarksDemo;
        initBookmarks();
      }
    </script>

    <!-- åŠ è½½BookmarksDemoç¤ºä¾‹æ•°æ® -->
    <script src="bookmark-loader.js"></script>
  </body>
</html>
